function loadData(){var e=$("#barcode_tabel");if(e.length!=0){loadBarcodes();loadDealers()}}function loadBarcodes(){var e=$("#barcode_tabel");var t=0;var n=0;$.ajax({dataType:"json",type:"POST",url:"./functions/API.php?action=print",data:{password:password}}).fail(function(){alert("Getting barcodes failed!")}).done(function(r){e.empty();$.each(r,function(r,i){t++;var s=$("<tr>");var o=$("<td>").text(i["code"]);s.append(o);var u=$("<td>").text(i["description"]);s.append(u);var a=$("<td>").text(i["leverancier"]);s.append(a);if(i["latitude"]&&i["longitude"]&&i["latitude"]!=""&&i["longitude"]!=""){var f=$("<td>").html('<a href="http://maps.google.com/?q='+i["latitude"]+","+i["longitude"]+'" target="_blank"><span class="glyphicon glyphicon-globe"></span></a>').css("text-align","center");s.append(f)}else{s.append($("<td>"))}if(i["returned"]!=0){n++;s.append($("<td>"));s.addClass("success")}else{var l=$("<td>").html('<span class="glyphicon glyphicon-ok"></span>').css("text-align","center").css("cursor","pointer").attr("id",i["code"]);l.click(checkoutCode);s.append(l)}var c=$("<td>").html('<span class="glyphicon glyphicon-remove"></span>').css("text-align","center").css("cursor","pointer").attr("id",i["code"]);c.click(deleteCode);s.append(c);e.append(s);$("#magazijn_status").text(n+"/"+t+" checked out")})})}function loadDealers(){$.ajax({dataType:"json",type:"POST",url:"./functions/API.php?action=dealers",data:{password:password}}).fail(function(){alert("Getting dealers failed!")}).done(function(e){dealers=[];$.each(e,function(e,t){dealers.push(t["naam"])});$("#barcode_dealer").autocomplete({source:dealers})})}function newBarcode(){var e=$("#barcode_code").val();var t=$("#barcode_name").val();var n=$("#barcode_dealer").val();$.ajax({dataType:"json",type:"POST",url:"./functions/API.php?action=insert",data:{password:password,leverancier:n,barcode:e,description:t}}).fail(function(e){alert("Error happened during insert")}).done(function(e){$("#barcode_dialog").dialog();setTimeout(function(){$("#barcode_dialog").dialog("close")},2e3);loadData()})}function loadMap(){var e=$("#magazijn_map");var t=[];if(e.length!=0){var n={zoom:8,center:new google.maps.LatLng(-34.397,150.644)};map=new google.maps.Map(document.getElementById("magazijn_map"),n);$.ajax({dataType:"json",type:"POST",url:"./functions/API.php?action=print",data:{password:password}}).fail(function(){alert("Getting barcodes failed!")}).done(function(e){$.each(e,function(e,n){if(n["returned"]!=1&&n["longitude"]!=""&&n["latitude"]!=""&&n["latitude"]&&n["longitude"]){t.push(n)}});if(t.length>0){addMarkers(t)}})}}function addMarkers(e){var t=0;var n=0;$.each(e,function(e,r){var i=new google.maps.LatLng(r["latitude"],r["longitude"]);var s=new google.maps.InfoWindow({content:'<div style="width:200px; height:100px">'+"<h2>"+r["code"]+"</h2>"+r["description"]+" - Supplied by: "+r["leverancier"]+"</div>"});var o=new google.maps.Marker({position:i,title:r["code"]});google.maps.event.addListener(o,"click",function(){s.open(map,o)});o.setMap(map);t=r["latitude"];n=r["longitude"]});map.setCenter(new google.maps.LatLng(t,n))}function checkoutCode(){var e=$(this).attr("id");$.ajax({dataType:"json",type:"POST",url:"./functions/API.php?action=checkout",data:{password:password,barcode:e}}).fail(function(){alert("Checking out item failed!")}).done(function(){loadBarcodes()})}function deleteCode(){var e=$(this).attr("id");$("#barcode_delete").dialog({resizable:false,height:200,modal:true,buttons:{"Delete barcode":function(){$.ajax({dataType:"json",type:"POST",url:"./functions/API.php?action=delete",data:{password:password,barcode:e}}).fail(function(){alert("Deleting item failed!")}).done(function(){loadBarcodes()});$(this).dialog("close")},Cancel:function(){$(this).dialog("close")}}})}var password;var dealers;var map;$("document").ready(function(){password=$.cookie("sko_magazijn");$("#barcode_btn").click(newBarcode);loadData();loadMap()})